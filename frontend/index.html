<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="icon" type="image/svg+xml" href="assets/shloguinho.png" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APPSHC</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: Arial;
            font-weight: 400;
            letter-spacing: 1px;
        }

        body {
            background-color: #273142;
        }

        section {
            max-width: fit-content;
            padding-inline: 2rem;
            height: 100vh;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            color: #fff;
            font-size: 46px;
            margin-bottom: 7rem;
            width: 800px;
            text-align: center;
        }

        p {
            color: #fff;
            font-size: 20px;
        }

        span {
            color: #227298;
        }

        .exibidor {
            background-color: #e1e1e1;
            max-width: 1800px;
            display: flex;
            gap: 1rem;
            padding: 2rem;
            border-radius: 15px;
        }

        .subExibidor {
            background-color: #227298;
            border-radius: 9px;
            width: 260px;
            padding-inline: 2rem;
            padding-block: 1.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .selecionado {
            box-shadow: 0px 0px 15px 4.5px #2CFFE6;
            transition: 0.3s ease;
            transform: scale(1.03);
        }
    </style>

    <script>
        function falarTexto(texto) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(texto);
                utterance.lang = 'pt-BR';
                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }
        }

        let vozDesbloqueada = false;
        function desbloquearVoz() {
            if (!vozDesbloqueada && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('');
                utterance.lang = 'pt-BR';
                speechSynthesis.speak(utterance);
                vozDesbloqueada = true;
            }
        }

        function ehApenasEmoji(texto) {
            const t = (texto || '').trim();
            if (!t) return false;
            const temEmoji = /[\p{Emoji}\u200d]/u.test(t);
            const temAlphaNum = /[A-Za-zÃ€-Ã–Ã˜-Ã¶Ã¸-Ã¿0-9]/.test(t);
            return temEmoji && !temAlphaNum;
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (!sessionStorage.getItem('sessaoAtiva')) {
                localStorage.removeItem('palavrasSelecionadas');
                sessionStorage.setItem('sessaoAtiva', 'true');
            }

            const classes = [
                { nome: "Frase Pronta", link: "./pages/frasePronta.html" },
                { nome: "Pronome", link: "./pages/pronome.html" },
                { nome: "Substantivo", link: "./pages/substantivo.html" },
                { nome: "Verbo", link: "./pages/verbo.html" },
                { nome: "Adjetivo", link: "./pages/adjetivo.html" },
                { nome: "AdvÃ©rbio", link: "./pages/adverbio.html" },
                { nome: "Emoji", link: "./pages/emoji.html" }
            ];

            const exibidores = document.querySelectorAll('.exibidor .subExibidor p');
            const exibidorContainer = document.querySelector('.exibidor');

            let slotAtual = 0;
            let etapa = 0;
            let palavraIndex = 0;
            let timer;

            let lista = JSON.parse(localStorage.getItem('palavrasSelecionadas') || '[]');
            if (lista.length > 0) {
                lista.forEach((texto, i) => {
                    if (exibidores[i]) exibidores[i].textContent = texto;
                });
                slotAtual = lista.length;
            }

            function mostrarProximaPalavra() {
                if (slotAtual >= exibidores.length) {
                    exibidorContainer.classList.add("selecionado");

                    let frase = Array.from(exibidores)
                        .map(p => p.textContent.trim())
                        .filter(t =>
                            t.length > 0 &&
                            t !== "c o n c l u i r" &&
                            t !== "r e s e t" &&
                            !ehApenasEmoji(t)
                        )
                        .join(" ");
                    if (frase) {
                        falarTexto(frase);
                    }

                    setTimeout(() => {
                        resetSlots();
                        startCarousel();
                    }, 4000);
                    return;
                }

                let palavra;
                if (slotAtual === 0) {
                    palavra = classes[palavraIndex].nome;
                    palavraIndex = (palavraIndex + 1) % classes.length;
                } else {
                    if (etapa === 0) {
                        palavra = "r e s e t";
                        etapa = 1;
                    } else if (etapa === 1) {
                        palavra = "c o n c l u i r";
                        etapa = 2;
                    } else {
                        palavra = classes[palavraIndex].nome;
                        palavraIndex = (palavraIndex + 1) % classes.length;
                    }
                }

                exibidores[slotAtual].textContent = palavra;
            }

            function avancarSlot() {
                slotAtual++;
                etapa = 0;
            }

            function resetSlots() {
                exibidores.forEach(s => s.textContent = "");
                exibidorContainer.classList.remove("selecionado");
                localStorage.removeItem('palavrasSelecionadas');
                slotAtual = 0;
                etapa = 0;
                palavraIndex = 0;
            }

            function startCarousel() {
                clearInterval(timer);
                timer = setInterval(mostrarProximaPalavra, 4000);
            }

            // ðŸ”¥ Tornando global:
            window.handleTrigger = function () {
                desbloquearVoz();

                const palavra = exibidores[slotAtual].textContent;
                if (palavra === "r e s e t") {
                    resetSlots();
                    return;
                }
                if (palavra === "c o n c l u i r") {
                    clearInterval(timer);
                    exibidorContainer.classList.add("selecionado");

                    let frase = Array.from(exibidores)
                        .map(p => p.textContent.trim())
                        .filter(t =>
                            t.length > 0 &&
                            t !== "c o n c l u i r" &&
                            t !== "r e s e t" &&
                            !ehApenasEmoji(t)
                        )
                        .join(" ");
                    if (frase) {
                        falarTexto(frase);
                    }

                    setTimeout(() => {
                        resetSlots();
                        startCarousel();
                    }, 3900);
                    return;
                }
                const classeObj = classes.find(c => c.nome === palavra);
                if (classeObj) {
                    window.location.href = classeObj.link;
                }
            };

            startCarousel();

            document.querySelector('button').addEventListener('click', window.handleTrigger);
        });
    </script>

</head>

<body>
    <section>
        <h1>Feche os olhos por <span>2 segundos</span> para escolher a <span>classe gramatical</span></h1>

        <div class="exibidor">

            <div class="subExibidor" id="e1">
                <p></p>
            </div>
            <div class="subExibidor" id="e2">
                <p></p>
            </div>
            <div class="subExibidor" id="e3">
                <p></p>
            </div>
            <div class="subExibidor" id="e4">
                <p></p>
            </div>
            <div class="subExibidor" id="e5">
                <p></p>
            </div>
            <div class="subExibidor" id="e6">
                <p></p>
            </div>

        </div>
        <!-- <a href="./pages/verbo.html">verbo</a>
        <a href="./pages/adjetivo.html">adjetivo</a>
        <a href="./pages/numeral.html">numeral</a>
        <a href="./pages/adverbio.html">adverbio</a>
        <a href="./pages/substantivo.html">substantivo</a>
        <a href="./pages/pronome.html">pronome</a>
        <a href="./pages/frasePronta.html">frases</a>
        <button>Entrar na classe</button> -->

    </section>
    <script src="script.js"></script>
</body>

</html>